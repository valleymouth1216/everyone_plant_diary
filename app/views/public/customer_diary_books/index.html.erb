<div class='container'>

<div class="content">


    <h2 class="section-ttl"><%= @customer.name %>さんの日記一覧</h2>


<div class='container'>

  <div class="row mt-5">

    <div class='mb-5 col-md-2' >
      <table class="table" style="border:2px solid silver">
        <thead>
          <tr><th>日記帳一覧</th></tr>
            <% if params[:tag_ids].present? %>
              <tr><th>
                <% params[:tag_ids].each do |key, value| %>
                  <% if value == "1" %>
                    <span>"<%= key %>"</span>
                  <% end %>
                <% end %>
                のタグ一覧
               </th></tr>
          <% end %>
        </thead>
        <tbody style="border-bottom: 1px solid silver;">
        <% @diary_books.each do |diary_book| %>
          <tr>
              <% if diary_book.id.present? %>
            <td>
              <%= link_to diary_book.title, customer_customer_diary_books_path(diary_book: diary_book.id), class: "text-secondary" %>
              <% end %>
            </td>
            <% end %>
          </tr>
          <%= paginate @diary_books %>
          </tbody>
      </table>
    </div>

    <%= form_tag({controller:"customer_diary_books",action:"index"}, method: :get) do %>
      <% Tag.all.each do |t| %>
        <%= check_box :tag_ids, t.name %><%= t.name %>
      <% end %>
      <%= submit_tag '検索' %>
    <% end %>


<% if @diary_book.present? %>

    <div class='col-md-10'>
      <h1 class="mb-3"><%= @diary_book.title %>の日記</h1>

      <% if @diary_date.present? %>
       <p>最新記録日付：<%= @diary_date.start_time.strftime('%Y/%m/%d') %></p>
       <% else %>
       <p>この日記帳は何も投稿されていません。</p>
      <% end %>

        <%= month_calendar events: @diary_dates do |date, diary_dates| %>
          <%= date.day %>
            <% diary_dates.each do |diary_date| %>
            <div>
              <% if diary_date.diary_images.attached? %>
                <%= link_to customer_customer_diary_book_path(@customer,diary_date) do %>
                  <%= image_tag diary_date.diary_images[0].representation(resize_to_limit: [200, 180]).processed, class: "review-img"%>
                <% end %>
              <% else %>
                <%= link_to customer_customer_diary_book_path(@customer,diary_date) do %>
                  <%= diary_date.body.truncate(10, omission: '...続き') %>
        　       <% end %></br>
                <%#= link_to '日記を編集する', edit_diary_book_diary_path(@diary_books,diary) %>
               <%#= link_to "削除", diary_book_diary_path(@diary_books,diary), method: :delete, "data-confirm" => "本当に削除しますか？" ,class: "btn btn-danger ml2"  %>
              <% end %>
            </div>
            <% end %>
        <% end %>
    </div>
  <% else %>
    <p>日記帳を選択してください</p>
  <% end %>

  </div>

</div>